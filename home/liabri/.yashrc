# colours
alias grep="grep --color=auto"
alias ls="ls --color=auto"

# aliases
alias cp="cp -i"                        # confirm before overwriting something
alias rm="rm -i"                        # confirm before deleting something
alias df="df -h"                        # human-readable sizes
alias free="free -m"                    # show sizes in MB
alias feo="fastfetch"
alias doc="zathura --fork"

# pass shorthand
pass(){ [[ "$1" == "otp" ]] && shift && command pass otp -c "$@" || ([[ "$1" == "-c" || "$1" == "--clip" ]] && command pass "$@" || command pass -c "$@"); }

# git
alias ga="git add"
alias gp="git push -u origin master"
alias gs="git status"
alias gc="git commit -m"
alias gaa="git add -A"
alias gpf="git push -f"
alias gcm="git commit -m"
alias gca="git commit --amend"
alias gl="git log --all --decorate --oneline --graph"

# nix
alias rebuild="sudo nixos-rebuild switch --flake /etc/nixos#liabri"     # rebuild system permenantly
alias rebuild-test="sudo nixos-rebuild test --flake /etc/nixos#liabri"  # rebuild system w/o boot entry
alias nixcon="sudo nano /etc/nixos/configuration.nix"                   # edit /etc/nixos/configuration.nix
alias flake="sudo nano /etc/nixos/flake.nix"                            # edit /etc/nixos/flake.nix
alias src="nix search nixpkgs"                                          # search nixpkgs

# temporary session profile, reset on reboot via systemd. piggybacking off nix's profile-based pkgs
export PATH="$HOME/.cache/nix-session/wrappers:$PATH"
function ins() {
    if [ -z "$1" ]; then echo "Usage: ins <package>"; return 1; fi

    SESSION_PROF="$HOME/.local/state/nix/profiles/session";
    WRAPPERS_DIR="$HOME/.cache/nix-session/wrappers";
    D="$HOME/.cache/nix-session"

    mkdir -p "$WRAPPERS_DIR" "$D/config" "$D/data" "$D/cache"

    BEFORE=$(ls "$SESSION_PROF/bin" 2>/dev/null)
    export NIXPKGS_ALLOW_UNFREE=1
    nix profile add "nixpkgs#$1" --profile "$SESSION_PROF"

    for bin in $(ls "$SESSION_PROF/bin"); do
        case " $BEFORE " in *" $bin "*) continue;; esac
        printf '#!/bin/sh\nexport XDG_CONFIG_HOME="%s/config" XDG_DATA_HOME="%s/data" XDG_CACHE_HOME="%s/cache"\nexec "%s/bin/%s" "$@"' "$D" "$D" "$D" "$SESSION_PROF" "$bin" > "$WRAPPERS_DIR/$bin"
        chmod +x "$WRAPPERS_DIR/$bin"
    done
}

# nice colours and username escape
export PS1=\
'\fm.${LOGNAME} '\
'\fw.${{{PWD:/~/\~}##*/}:-$PWD}'\
"\fm.${SSH_CONNECTION:+@${HOSTNAME}}"\
"\fm \$\fd "

# yash
HISTFILE=${XDG_CACHE_HOME}/yash_history HISTSIZE=5000

# normally yash is more POSIX-compliant than /bin/sh :-)
sh() { yash --posix "$@"; }
yash() { command yash "$@"; }

# colours
if [ "$TERM" = "linux" ]; then
    echo -en "\e]P0000000" #black
    echo -en "\e]P8918f8f" #darkgrey
    echo -en "\e]P1e56f92" #darkred
    echo -en "\e]P9e56f92" #red
    echo -en "\e]P28cd7aa" #darkgreen
    echo -en "\e]PA8cd7aa" #green
    echo -en "\e]P3D7AF87" #brown
    echo -en "\e]PBe9967e" #yellow
    echo -en "\e]P479aaeb" #darkblue
    echo -en "\e]PC79aaeb" #blue
    echo -en "\e]P5c488ec" #darkmagenta
    echo -en "\e]PDc488ec" #magenta
    echo -en "\e]P67abce4" #darkcyan
    echo -en "\e]PE7abce4" #cyan
    echo -en "\e]P7daddee" #lightgrey
    echo -en "\e]PFdaddee" #white
    clear #for background artifacting
fi
